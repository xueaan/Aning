<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Anning</title>
    
    <!-- 🚀 资源预加载优化 -->
    <link rel="preconnect" href="http://localhost:3000" crossorigin>
    <link rel="dns-prefetch" href="http://localhost:3000">
    
    <!-- 预加载关键模块 -->
    <link rel="modulepreload" href="/src/main.tsx">
    <link rel="modulepreload" href="/src/App.tsx">
    <link rel="modulepreload" href="/src/stores/index.ts">
    
    <!-- 预加载关键CSS -->
    <link rel="preload" href="/src/styles/index.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/src/styles/index.css"></noscript>
    
    <style>
      /* 🔥 关键内联样式：立即消除白屏 */
      :root {
        /* 默认浅色主题变量 */
        --bg-primary: 255, 255, 255;
        --bg-secondary: 250, 251, 254;
        --text-primary: 15, 23, 42;
        --text-secondary: 71, 85, 105;
        --border-primary: 226, 232, 240;
        --color-primary: 102, 126, 234;
        --color-secondary: 240, 147, 251;
      }
      
      /* 深色主题检测 */
      @media (prefers-color-scheme: dark) {
        :root {
          --bg-primary: 15, 23, 42;
          --bg-secondary: 30, 41, 59;
          --text-primary: 248, 250, 252;
          --text-secondary: 203, 213, 225;
          --border-primary: 71, 85, 105;
        }
      }
      
      /* 主题检测脚本应用的类 */
      [data-theme="light"] {
        --bg-primary: 255, 255, 255;
        --bg-secondary: 250, 251, 254;
        --text-primary: 15, 23, 42;
        --text-secondary: 71, 85, 105;
        --border-primary: 226, 232, 240;
      }
      
      [data-theme="dark"] {
        --bg-primary: 15, 23, 42;
        --bg-secondary: 30, 41, 59;
        --text-primary: 248, 250, 252;
        --text-secondary: 203, 213, 225;
        --border-primary: 71, 85, 105;
      }
      
      /* 立即应用样式，避免白屏 */
      html, body, #root {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      
      html {
        /* 立即设置背景，避免白屏闪烁 */
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      }
      
      body {
        background: rgba(var(--bg-primary), 1);
        color: rgba(var(--text-primary), 1);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        overflow: hidden;
        transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out;
      }
      
      /* 🎨 简洁的加载屏 - 当root为空时显示 */
      #root:empty {
        display: flex;
        height: 100vh;
        background: rgba(var(--bg-primary), 1);
        position: relative;
        overflow: hidden;
        align-items: center;
        justify-content: center;
      }
      
      /* 简洁的加载指示器 */
      #root:empty::after {
        content: '';
        width: 24px;
        height: 24px;
        border: 3px solid rgba(var(--color-primary), 0.2);
        border-top-color: rgba(var(--color-primary), 0.8);
        border-radius: 50%;
        animation: simpleSpinner 1s linear infinite;
      }
      
      @keyframes simpleSpinner {
        0% { 
          transform: rotate(0deg);
        }
        100% { 
          transform: rotate(360deg);
        }
      }
      
      /* 立即显示，移除渐显动画 */
      #root {
        opacity: 1;
      }
      
      /* 🚀 关键主题类 - 内联避免阻塞首次渲染 */
      .theme-bg-primary { background-color: rgba(var(--bg-primary), 1); }
      .theme-bg-secondary { background-color: rgba(var(--bg-secondary), 1); }
      .theme-text-primary { color: rgba(var(--text-primary), 1); }
      .theme-text-secondary { color: rgba(var(--text-secondary), 1); }
      .theme-border-primary { border-color: rgba(var(--border-primary), 1); }
      .theme-glass-card {
        background: rgba(var(--bg-secondary), 0.9);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 2px solid rgba(var(--border-primary), 1);
        transition: all 0.3s ease;
      }
      .theme-gradient-bg {
        background: var(--gradient-theme, linear-gradient(135deg, rgba(102, 126, 234, 0.7) 0%, rgba(240, 147, 251, 0.7) 50%, rgba(245, 87, 108, 0.7) 100%));
        position: relative;
      }
      .with-noise::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='1' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.3'/%3E%3C/svg%3E");
        opacity: var(--noise-opacity, 0.3);
        pointer-events: none;
        z-index: 0;
      }
    </style>
    
    <script>
      /* 🔥 立即主题检测脚本 - 避免主题闪烁 */
      (function() {
        // 🚀 彻底禁用和清理Service Worker - 解决网络错误和白屏问题
        if ('serviceWorker' in navigator) {
          // 立即阻止任何新的 Service Worker 注册
          navigator.serviceWorker.register = function() {
            console.warn('⚠️ Service Worker 注册已被禁用');
            return Promise.reject(new Error('Service Worker disabled'));
          };
          
          // 清理所有现有的 Service Worker
          navigator.serviceWorker.getRegistrations().then(function(registrations) {
            for(let registration of registrations) {
              console.log('🧹 强制清理 Service Worker:', registration.scope);
              registration.unregister();
            }
          }).catch(function(err) {
            console.error('清理 Service Worker 失败:', err);
          });
          
          // 清理所有缓存
          if ('caches' in window) {
            caches.keys().then(function(names) {
              names.forEach(function(name) {
                console.log('🗑️ 清理缓存:', name);
                caches.delete(name);
              });
            }).catch(function(err) {
              console.error('清理缓存失败:', err);
            });
          }
        }
        
        // 检测开发模式
        const isDev = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        
        if (isDev) {
          document.documentElement.classList.add('dev-mode');
        }
        
        // 主题设置
        const savedTheme = localStorage.getItem('theme');
        const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = savedTheme || (systemPrefersDark ? 'dark' : 'light');
        
        // 应用主题
        document.documentElement.setAttribute('data-theme', theme);
        
        // CSS变量设置
        document.documentElement.style.setProperty(
          '--gradient-theme',
          'linear-gradient(135deg, rgba(102, 126, 234, 0.7) 0%, rgba(240, 147, 251, 0.7) 50%, rgba(245, 87, 108, 0.7) 100%)'
        );
        
        console.log('🎨 主题初始化完成:', theme);
      })();
    </script>
  </head>
  <body>
    
    <div id="root"></div>
    
    
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>