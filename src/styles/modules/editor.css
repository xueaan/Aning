/* =============================================================================
   Anning 主题系统 - 编辑器模块样式
   Modules/Editor - 编辑器模块专用样式 (Novel Editor, Line Editor)
============================================================================= */

/* =================
   编辑器容器基础样式
   ================= */

.editor-container {
  background: rgba(var(--bg-primary), 0.95);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 1px solid rgba(var(--border-primary), 0.3);
  border-radius: var(--radius-xl);
  overflow: visible; /* 修复：改为visible避免containing block问题 */
  transition: all var(--duration-fast) ease;
}

.editor-container:focus-within {
  border-color: rgba(var(--color-accent), 0.5);
  box-shadow: 0 0 0 3px rgba(var(--color-accent), 0.1);
}

/* =================
   Novel Editor 样式
   ================= */

.novel-editor-container {
  background: transparent;
  border: none;
  outline: none;
  min-height: 400px;
  padding: var(--spacing-lg);
  color: rgba(var(--text-primary), 1);
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
  line-height: 1.7;
  caret-color: rgba(var(--color-accent), 1);
}

/* Novel Editor 工具栏 */
.novel-editor-toolbar {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-md) var(--spacing-lg);
  background: rgba(var(--bg-secondary), 0.8);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border-bottom: 1px solid rgba(var(--border-primary), 0.3);
  flex-wrap: wrap;
}

.novel-editor-button {
  background: rgba(var(--bg-primary), 0.7);
  border: 1px solid rgba(var(--border-primary), 0.3);
  border-radius: var(--radius-sm);
  padding: var(--spacing-xs) var(--spacing-sm);
  color: rgba(var(--text-secondary), 1);
  cursor: pointer;
  transition: all var(--duration-fast) ease;
  font-size: 0.85rem;
  
  /* 按钮尺寸 */
  min-width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.novel-editor-button:hover {
  background: rgba(var(--bg-primary), 0.9);
  border-color: rgba(var(--border-secondary), 0.5);
  color: rgba(var(--text-primary), 1);
}

.novel-editor-button.active {
  background: rgba(var(--color-accent), 0.8);
  border-color: rgba(var(--color-accent), 0.6);
  color: rgba(var(--text-inverse), 1);
}

/* Novel Editor 高亮颜色 */
.novel-highlight-default { background-color: var(--novel-highlight-default); }
.novel-highlight-purple { background-color: var(--novel-highlight-purple); }
.novel-highlight-red { background-color: var(--novel-highlight-red); }
.novel-highlight-yellow { background-color: var(--novel-highlight-yellow); }
.novel-highlight-blue { background-color: var(--novel-highlight-blue); }
.novel-highlight-green { background-color: var(--novel-highlight-green); }
.novel-highlight-orange { background-color: var(--novel-highlight-orange); }
.novel-highlight-pink { background-color: var(--novel-highlight-pink); }
.novel-highlight-gray { background-color: var(--novel-highlight-gray); }

/* =================
   Line Editor 样式
   ================= */

.line-editor-container {
  display: flex;
  flex-direction: column;
  background: rgba(var(--bg-primary), 0.9);
  border: 1px solid rgba(var(--border-primary), 0.3);
  border-radius: var(--radius-lg);
  overflow: hidden;
}

.line-editor-input {
  background: transparent;
  border: none;
  outline: none;
  padding: var(--spacing-md) var(--spacing-lg);
  color: rgba(var(--text-primary), 1);
  font-size: 0.95rem;
  line-height: 1.6;
  resize: none;
  min-height: 120px;
  caret-color: rgba(var(--color-accent), 1);
}

.line-editor-input::placeholder {
  color: rgba(var(--text-tertiary), 0.7);
  font-style: italic;
}

/* Line Editor 工具栏 */
.line-editor-toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-sm) var(--spacing-md);
  background: rgba(var(--bg-secondary), 0.6);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  border-top: 1px solid rgba(var(--border-primary), 0.2);
}

.line-editor-actions {
  display: flex;
  gap: var(--spacing-xs);
}

.line-editor-meta {
  font-size: 0.75rem;
  color: rgba(var(--text-tertiary), 0.8);
}

/* =================
   编辑器通用样式
   ================= */

/* 编辑器选中文本 */
.editor-container ::selection {
  background: rgba(var(--color-accent), 0.2);
  color: rgba(var(--text-primary), 1);
}

/* 编辑器占位符统一样式 */
.editor-placeholder {
  color: rgba(var(--text-tertiary), 0.6);
  font-style: italic;
  pointer-events: none;
  position: absolute;
  top: var(--spacing-lg);
  left: var(--spacing-lg);
  transition: opacity var(--duration-fast) ease;
}

.editor-container:focus-within .editor-placeholder {
  opacity: 0;
}

/* =================
   编辑器状态指示器
   ================= */

.editor-status-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-xs) var(--spacing-md);
  background: rgba(var(--bg-tertiary), 0.6);
  border-top: 1px solid rgba(var(--border-primary), 0.2);
  font-size: 0.75rem;
  color: rgba(var(--text-tertiary), 0.8);
}

.editor-word-count {
  font-weight: 500;
}

.editor-save-status {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.editor-save-indicator {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: rgba(var(--color-success), 1);
  transition: all var(--duration-fast) ease;
}

.editor-save-indicator.saving {
  background: rgba(var(--color-warning), 1);
  animation: pulse 1s infinite;
}

.editor-save-indicator.error {
  background: rgba(var(--color-error), 1);
}

/* =================
   融合式编辑器 (无边框)
   ================= */

.seamless-editor-container {
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  border-radius: 0 !important;
  padding: 0 !important;
  margin: 0 !important;
}

.seamless-editor-container,
.timeline-editor-transparent {
  color: rgba(var(--text-primary), 1) !important;
  caret-color: rgba(var(--color-accent), 1) !important;
}

/* 深色模式下的融合编辑器 */
[data-theme="dark"] .seamless-editor-container,
[data-theme="dark"] .timeline-editor-transparent {
  color: rgba(var(--text-primary), 0.95) !important;
}

/* 编辑器选中文本样式 */
.seamless-editor-container ::selection,
.timeline-editor-transparent ::selection {
  background: rgba(var(--color-accent), 0.3) !important;
}

/* 编辑器占位符样式 */
.seamless-editor-container .ProseMirror-empty::before,
.timeline-editor-transparent .ProseMirror-empty::before,
.seamless-editor-container .bn-editor[data-is-empty="true"] .bn-inline-content:before,
.timeline-editor-transparent .bn-editor[data-is-empty="true"] .bn-inline-content:before {
  color: rgba(var(--text-tertiary), 1) !important;
  opacity: 0.6 !important;
}

/* =================
   编辑器代码块样式
   ================= */

.editor-code-block {
  background: rgba(var(--bg-secondary), 0.8);
  border: 1px solid rgba(var(--border-primary), 0.3);
  border-radius: var(--radius-md);
  padding: var(--spacing-md);
  margin: var(--spacing-md) 0;
  font-family: 'JetBrains Mono', 'Fira Code', 'SF Mono', Consolas, monospace;
  font-size: 0.9em;
  line-height: 1.6;
  color: rgba(var(--text-primary), 1);
  overflow-x: auto;
}

.editor-inline-code {
  background: rgba(var(--bg-tertiary), 0.7);
  border: 1px solid rgba(var(--border-primary), 0.2);
  border-radius: var(--radius-sm);
  padding: 0.1em 0.3em;
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  font-size: 0.9em;
  color: rgba(var(--color-accent), 1);
}

/* =================
   编辑器引用块样式
   ================= */

.editor-blockquote {
  border-left: 4px solid rgba(var(--color-accent), 0.5);
  background: rgba(var(--bg-tertiary), 0.3);
  padding: var(--spacing-md) var(--spacing-lg);
  margin: var(--spacing-md) 0;
  border-radius: 0 var(--radius-md) var(--radius-md) 0;
  font-style: italic;
  color: rgba(var(--text-secondary), 1);
}

/* =================
   编辑器表格样式
   ================= */

.editor-table {
  width: 100%;
  border-collapse: collapse;
  margin: var(--spacing-md) 0;
  background: rgba(var(--bg-secondary), 0.3);
  border-radius: var(--radius-md);
  overflow: hidden;
}

.editor-table th {
  background: rgba(var(--bg-tertiary), 0.8);
  padding: var(--spacing-sm) var(--spacing-md);
  text-align: left;
  font-weight: 600;
  color: rgba(var(--text-primary), 1);
  border-bottom: 2px solid rgba(var(--border-primary), 0.3);
}

.editor-table td {
  padding: var(--spacing-sm) var(--spacing-md);
  border-bottom: 1px solid rgba(var(--border-primary), 0.2);
  color: rgba(var(--text-primary), 1);
}

.editor-table tr:hover {
  background: rgba(var(--bg-secondary), 0.5);
}

/* =================
   编辑器链接样式
   ================= */

.editor-link {
  color: rgba(var(--color-accent), 1);
  text-decoration: none;
  border-bottom: 1px solid rgba(var(--color-accent), 0.3);
  transition: all var(--duration-fast) ease;
}

.editor-link:hover {
  color: rgba(var(--color-accent), 0.8);
  border-bottom-color: rgba(var(--color-accent), 0.6);
  background: rgba(var(--color-accent), 0.1);
  padding: 0 2px;
  border-radius: var(--radius-sm);
}

/* =================
   响应式设计
   ================= */

@media (max-width: 768px) {
  .novel-editor-toolbar {
    padding: var(--spacing-sm);
  }
  
  .novel-editor-container {
    padding: var(--spacing-md);
  }
  
  .line-editor-input {
    padding: var(--spacing-sm) var(--spacing-md);
    min-height: 100px;
  }
  
  .editor-toolbar {
    flex-wrap: wrap;
    gap: var(--spacing-xs);
  }
}